# 用户

## 概念

1. 权限控制以vhost为单位。

## 管理

### 用户管理

#### 创建

```shell
rabbitmqctl add_user {userName} {password}
```

#### 修改密码

```
rabbitmqctl change_password {userName} {newPassword}
```

#### 清除密码

```shell
rabbitmqctl clear_password {userName}
```

#### 密码验证

```shell
rabbitmqctl authenticate_user {userName} {password}
```

#### 删除

```shell
rabbitmqctl delete_user {userName}
```

#### 查看列表

```shell
rabbitmqctl list_users
```

每个结果行都包含用户的名称和用户的角色【tags】，角色如下：

1. none：无任何角色。新创建的用户的角色默认为none。
2. management：可访问web管理页面。
3. policymaker：包括management的所有权限，并且可以管理策略和参数。
4. monitoring：包括management的所有权限，并且可以看到连接、信道及节点相关信息。
5. administartor：包括monitoring的所有权限，并且可以管理用户，虚拟主机，权限，策略，参数等。代表最高权限。

#### 设置用户角色

```shell
rabbitmqctl set_user_tags {userName} {tags...}
```

### 权限管理

#### 授予权限

```shell
rabbitmqctl set_permissions [-p host] {user} {conf} {write} {read}
```

1. user：可以访问指定vhost的用户名。

2. conf：可配置权限的正则表达式，用于匹配资源。指的是队列和交换器的创建及删除之类的操作。

3. write：可写权限的正则表达式，用于匹配资源。指的是发布消息。

4. Read：可读权限的正则表达式，用于匹配资源。指的是与消息有关的操作。

5. 命令与权限的映射关系：

   ![amqp与权限的对应关系](/Users/sunchen/Documents/notes/中间件/rabbitmq/实战指南/imgs/amqp与权限的对应关系.png)

#### 清除权限

```shell
rabbitmqctl clear_permissions [-p host] {userName}
```

#### 列举虚拟主机纬度的权限信息

```shell
rabbitmqctl list_permissions [-p host]
```

#### 列举用户纬度的权限信息

```shell
rabbitmqctl list_user_permissions {userName}
```