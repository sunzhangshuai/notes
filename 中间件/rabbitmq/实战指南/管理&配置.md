# 管理

**大括号代表必选**。**中括号代表可选**。...**代表多值**。

## rabbitmqctl语法

```shell
rabbitmqctl [-n node] [-t timeout] [-q] {command} [command options...]
```

1. node：默认节点是rabbitmq@hostname。
2. timeout：操作超时时间，只用于「list_XXX」的命令。默认无穷大。
3. q：以静默模式启动，屏蔽一些消息的输出。默认不开启。

## 虚拟主机

1. 创建vhost

   ```sh
   rabbitmqctl add_vhost {vhostName}
   ```

2. 查看vhost列表相关信息

   ```shell
   rabbitmqctl list_vhosts [vhostinfoitem...]
   ```

   1. vhostinfoitem取值有两个，代表结果要展示的列。
   2. name：vhost名称。
   3. tracing：表示是否使用了trace功能。

3. 删除vhost

   ```shell
   rabbitmqctl delete_vhost {vhostName}
   ```

## 用户权限

权限控制以vhost为单位。

1. 授予权限

   ```shell
   rabbitmqctl set_permissions [-p host] {user} {conf} {write} {read}
   ```

   1. user：可以访问指定vhost的用户名。

   2. conf：可配置权限的正则表达式，用于匹配资源。指的是队列和交换器的创建及删除之类的操作。

   3. write：可写权限的正则表达式，用于匹配资源。指的是发布消息。

   4. Read：可读权限的正则表达式，用于匹配资源。指的是与消息有关的操作。

   5. 命令与权限的映射关系：

      ![amqp与权限的对应关系](imgs/amqp与权限的对应关系.png)

2. 清除权限

   ```shell
   rabbitmqctl clear_permissions [-p host] {userName}
   ```

3. 列举虚拟主机纬度的权限信息

   ```shell
   rabbitmqctl list_permissions [-p host]
   ```

4. 列举用户纬度的权限信息

   ```shell
   rabbitmqctl list_user_permissions {userName}
   ```

## 用户管理