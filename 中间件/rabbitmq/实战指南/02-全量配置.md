# 配置

优先级：环境变量 > 配置文件 > 默认配置

## 环境变量

|          变量名          | 含义                                                         |
| :----------------------: | :----------------------------------------------------------- |
| RABBITMQ_NODE_IP_ADDRESS | node所在的ip地址                                             |
|    RABBITMQ_NODE_PORT    | 监听客户端链接的接口，默认：5672。                           |
|    RABBITMQ_DIST_PORT    | 默认内部通信端口号，默认：25762                              |
|    RABBITMQ_NODENAME     | node的名称，默认rabbit@$HOSTNAME                             |
|  RABBITMQ_CONF_ENV_FILE  | 环境变量的配置文件的路径，默认：/$RABBITMQ_HOME/etc/rabbitmq/rabbitmq-env.conf |
|  RABBITMQ_USE_LONGNAME   | boolean值，是否显示长命名，例如：rabbit@node1.xxx            |
|    RABBITMQ_CONF_FILE    | 配置文件的路径，默认：/$RABBITMQ_HOME/etc/rabbitmq/rabbitmq  |
|   RABBITMQ_MNESIA_BASE   | RABBITMQ_MNESIA_DIR的父目录，默认值：/$RABBITMQ_HOME/var/lib/rabbitmq/manesia |
|   RABBITMQ_MNESIA_DIR    | 包含rabbitmq节点的数据库，数据存储和集群状态的目录，默认值为RABBITMQ_MNESIA_BASE/RABBITMQ_NODENAME |
|    RABBITMQ_LOG_BASE     | 服务日志的目录，默认：/$RABBITMQ_HOME/var/log/rabbitmq       |
|      RABBITMQ_LOGS       | 和ERAING相关的日志，默认：RABBITMQ_LOG_BASE/RABBITMQ_NODENAME.log |
|    RABBITMQ_SASL_LOGS    | SASL相关的日志，默认：RABBITMQ_LOG_BASE/RABBITMQ_NODENAME-sasl.log |
|   RABBITMQ_PLUGINS_DIR   | 插件所在路径，默认：/$RABBITMQ_HOME/plugins/                 |

## 配置文件

### 配置项

|                     变量名                     | 含义                                                         |
| :--------------------------------------------: | ------------------------------------------------------------ |
|                 tcp_listeners                  | 监听 AMQP 连接，可以配置为端口号或者端口号与主机名组成的元组。 |
|               num_tcp _acceptors               | 用来处理tcp连接的Erlang进程数目，默认：10                    |
|               handshake_timeout                | TCP握手超时时间，默认：100000                                |
|                 ssl_Iisteners                  | 同tcp_listeners，默认[]。                                    |
|               num_ssl _acceptors               | 用来处理ssl连接的Erlang进程数目，默认：1                     |
|                  ssl_options                   | ssl配置，默认为[]。                                          |
|             ssl_handshake_timeout              | ssl握手超时时间，默认5000.                                   |
|            vm_memory_high_watermark            | 触发流量控制的内存阈值。默认值为0.4。                        |
|         vm_memory_calculation_strategy         | 内存使用的报告方式。 共有<br/>( 1) rss: 采用操作系统的 RSS 的内存报告<br/>( 2 ) erlang: 采用 erlang 的内存报告<br/>默认值为 rss |
|     vm_memory_high_watermark_paging_ratio      | 内存高水位的百分比阈值，当达到阈值时，队列开始将消息持久化到磁盘以释放内 存。默认为0.5。 |
|                disk_free_limit                 | 存储数据分区的可用磁盘空间限制。当可用空间值低于阈值时，流程控制将被触发。 |
|                   log_levels                   | 日志等级：<br/>（1）channel：所有与 AMQP 信道相关的日志<br/>（2）connection：所有与连接相关的日志<br/>（3）federation：所有 federation 关的日志<br/>（4）mirroring：所有与镜像相关的日志<br/>日志级别有 5 种: <br/>none：表示不记录日志事件; <br/>error：表示只记录错误;<br/>wraning：只记录错误和告警;<br/>info：表示记录错误、告警和信息; <br/>debug：表示记录错误、告警信息和调试信息。<br/>默认值为[{connection. info}]。 |
|                    framemax                    | 与客户端协商的允许最大帧大小，单位为B，0为无限制。默认131072。 |
|                  channel_max                   | 与客户端协商的允许最大信道个数，0为无限制。默认为0。         |
|           channel_operation_timeout            | 信道运行的超时时间，单位为毫秒，默认值为15000。              |
|                   heartbeat                    | 服务端与客户端连接的心跳延时，单位为秒。默认60，0为禁用心跳。 |
|                 default_vhost                  | 默认的vhost，默认为"\\"。                                    |
|                  default_user                  | 默认的用户，默认为guest。                                    |
|                  default_pass                  | 默认的密码，默认为guest。                                    |
|              default _user _tags               | 默认的角色，默认为administastor。                            |
|              default_permissions               | 默认的权限，默认[<<".*"> <<".*">>, <<".*">>]                 |
|                 loopback_users                 | 设置只能通过本地网络(如 localhost) 来访问 Broker 的用 户列表。默认值为<<"guest">> |
|                 cluster_nodes                  | 可以用来配置集群。二元组，一个是要加入集群的节点名称，一个是节点类型。 |
|               server_properties                | 连接时向客户端声明的键值对列表。默认值为[]。                 |
|               collect_statistics               | 统计数据的收集模式，主要与RabbitMQ Management插件相关，共有3个值可选<br/>（1）none：不发布统计事件<br/>（2）coarse：发布每个队列/信道/连接的统计事件<br/>（3）fme：同时还发布每个消息的统计事件<br/>默认值为 none |
|          collect_statistics_interval           | 统计数据的收集时间间隔，主要与 RabbitM Management 插件相关。默认值为 5000。 |
|         management_db_cache_multiplier         | 设置管理插件将缓存代价较高的查询的时间。缓存将把最后一个查询的运行时间乘 以这个值，并在此时间内缓存结果。默认值为5。 |
|                 delegate_count                 | 内部集群通信中，委派进程的数目。在拥有很多个内核并且是集群中的一个节点的机器上可以增加此值。默认是16。 |
|               tcp_listen_options               | 默认的 socket 选项。                                         |
|                  hipe_compile                  | 将此值设置为true，就可以开启 HiPE 功能，即 Erlang 的即时编译器。 |
|           cluster_partition_handling           | 如何处理网络分区。                                           |
|           cluster_keepalive_interval           | 向其他节点发送存活消息的频率。单位为毫秒。默认100000。       |
|          queue_index_embed_msg_below           | 消息的大小小于此值时会直接嵌入到队列的索引中。单位为B，默认值为4096。 |
|             msg_store_index_module             | 队列索引的实现模块。                                         |
|              backing_queue_module              | 队列内容的实现模块。默认为rabbit_variable_queue。不建议修改此项。 |
|        mnesia_table_loading_retry_limit        | 等待集群中 Mnesia 数据表可用时最大的重试次数，默认值为10。   |
|       mnesia_table_loading_retry_timeout       | 每次重试时，等待集群中 Mnes 数据表可用时的超时时间。默认值为 30000。 |
|              queue_master_locator              | 队列的定位策略。                                             |
| lazy_queue_explicit_gc_run_operation_threshold | 在使用惰性队列（lazy queue）时进行内存回收动作的阀值。默认值为1000。 |
|   queue_explicit_gc_run_operation_threshold    | 在使用正常队列时进行内存回收动作的阀值。默认值为1000。       |

### 网络配置

|            参数项            | 描述                                                         |
| :--------------------------: | ------------------------------------------------------------ |
|  tcp_listen_options.nodelay  | 默认true，禁用Nagle算法。                                    |
|  tcp_listen_options.sndbuf   | tcp缓冲区大小，提高消费者的吞吐量                            |
|  tcp_listen_options.recbuf   | tcp缓冲区大小，提高发送者的吞吐量                            |
|  tcp_listen_options.backlog  | 队列中未接受连接的最大数目。                                 |
|  tcp_listen_options.linger   | 当套接字关闭时。用于设置刷新未发送数据的超时时间，单位为秒。 |
| tcp_listen_options.keepalive | 长连接。                                                     |
