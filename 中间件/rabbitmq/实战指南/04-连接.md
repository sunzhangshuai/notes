# 连接

## 概念

1. `Connection`可以用来创建多个`Channel`实例。
2. `Channel`实例不能线程间共享，每个线程应该创建一个`Channel`实例。

## 管理

```shell
rabbitmqctl list_connnects [connectionInfoItem...]
```

默认显示user、peer_host、peer_port和state。

1. pid：与连接相关的 `Erlang` 进程 ID。
2. name：连接的名称。
3. port：服务器端口。
4. host：返回反向 DNS 获取的服务器主机名称，或者 IP 地址，或者未启用。
5. peer_port：服务器对端端口。当一个客户端与服务器连接时，这个客户端的端口就peer_port。
6. peer_host：返回反向 DNS 获取的对端主机名称，或者 地址，或者未启用。
7. ssl：是否启用 SSL。
8. ssl_protocol：SSL 协议，如 tlsvl。
9. ssl_key_exchange：SSL 密钥交换算法，如 rsa。
10. ssl_cipher：SSL 加密算法，如 aes_256_cbc。
11. ssl_hash: SSL 哈希算法，如 sha。
12. peer_cert_subject：对端的 SSL 安全证书的主题，基于RFC4514 的形式。
13. peer_cert_issuer：对端 SSL 安全证书的发行者， 基于 RFC4514 的形式
14. peer_cert_validity：对端 SSL 安全证书的有效期。
15. state：连接状态，包括 starting、tuning、opening、running、flow、blocking、blocked、closing、closed 这几种。
16. channels：该连接中的信道个数。
17. protocol：使用的 AMQP 协议的版本，当前是 {0.9.1} 或者 {0.8.0} 。注意，如果客户端请求的是 AMQP 0.9 的连接， RabbitMQ 也会将其视为0.9.1。
18. auth_mechanism：使用的 SASL 认证机制，如 PLAIN、AMQPLAIN、EXTERNAL、RABBIT-CR-DEMO。
19. user：与连接相关的用户名。
20. vhost：与连接相关的 vhost 的名称。
21. timeout：连接超时/协商的心跳间隔，单位为秒。
22. frame_max：最大传输帧的大小，单位为B。
23. channel_max：此连接上信道的最大数量。如果值 0，则表示无上限，但客户端会将0转变为 65535。
24. client_properties：在建立连接期间由客户端发送的信息属性。
25. recv_oct：收到的字节数。
26. recv_cnt：收到的数据包个数。
27. send_oct：发送的字节数。
28. send_cnt：发送的数据包个数。
29. send_pend：发送队列大小。
30. connected_at：连接建立的时间戳。

## 配置

### tcp配置

文件配置：rabbitmq.conf

|        参数项         | 描述                                                         |
| :-------------------: | ------------------------------------------------------------ |
|     tcp_listeners     | 监听 AMQP 连接，可以配置为端口号或者端口号与主机名组成的元组。 |
|  num_tcp _acceptors   | 用来处理tcp连接的Erlang进程数目，默认：10                    |
|   handshake_timeout   | TCP握手超时时间，默认：100000                                |
|     ssl_Iisteners     | 同tcp_listeners，默认[]。                                    |
|  num_ssl _acceptors   | 用来处理ssl连接的Erlang进程数目，默认：1                     |
|      ssl_options      | ssl配置，默认为[]。                                          |
| ssl_handshake_timeout | ssl握手超时时间，默认5000.                                   |
|  tcp_listen_options   | 默认的 socket 选项。                                         |

### 网络配置

|            参数项            | 描述                                                         |
| :--------------------------: | ------------------------------------------------------------ |
|  tcp_listen_options.nodelay  | 默认true，禁用Nagle算法。                                    |
|  tcp_listen_options.sndbuf   | tcp缓冲区大小，提高消费者的吞吐量                            |
|  tcp_listen_options.recbuf   | tcp缓冲区大小，提高发送者的吞吐量                            |
|  tcp_listen_options.backlog  | 队列中未接受连接的最大数目。                                 |
|  tcp_listen_options.linger   | 当套接字关闭时。用于设置刷新未发送数据的超时时间，单位为秒。 |
| tcp_listen_options.keepalive | 长连接。                                                     |
