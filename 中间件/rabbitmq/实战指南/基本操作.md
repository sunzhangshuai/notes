# 连接

1. `Connection`可以用来创建多个`Channel`实例。
2. `Channel`实例不能线程间共享，每个线程应该创建一个`Channel`实例。

# 交换器

建议预先创建资源，通过后台管理系统。

## 声明交换器

```java
Exchange.DeclareOk exchangeDeclare(
 	String exchange,
  BuiltinExchangeType type,
  boolean durable,
  boolean autoDelete,
  boolean internal,
  Map<String, Object> arguments
) throws IOException;
```

1. exchange：交换器名称。
2. type：交换器类型，fanout、direct、topic等。
3. durable：是否持久化。true为持久化，将交换器存盘。
4. autoDelete：自动删除。true为当所有绑定队列都不在使用时，自动删除交换器。【**一次性**】
   1. 前提：必须有交换机或队列绑定过。
   2. 所有绑定都断开时，自动删除。
5. internal：是否设置成内置的。true为必须通过交换器路由到此交换器。
6. arguments：结构化参数。

## 绑定交换器

```java
Exchange.BindOk exchangeBind(
  String destination, 
  String source, 
  String routingKey, 
  Map<String, Object> arguments
) throws IOException;
```

1. destination：目标交换器。
   1. 一般目标交换器类型为：fanout。
2. source：源交换器。

## 解绑交换器

```java
Exchange.UnbindOk exchangeUnbind(
  String destination, 
  String source, 
  String routingKey, 
  Map<String, Object> arguments
) throws IOException;
```

# 队列

建议预先创建资源，通过后台管理系统。

## 声明队列

```java
Queue.DeclareOk queueDeclare(
  String queue, 
  boolean durable, 
  boolean exclusive, 
  boolean autoDelete,
  Map<String, Object> arguments
) throws IOException;
```

1. queue：队列名称。
2. durable：是否持久化。true为持久化，将队列存盘。
3. exclusive：是否排他，true为排他，仅对首次声明他的队列连接可见。
   1. 基于连接。
   2. 同一连接的不同信道可同时访问同一链接创建的排他队列。
   3. 排他队列全局不可重名。
   4. 连接关闭或客户端退出时删除，**即使持久化**。
4. autoDelete：自动删除。true为当所有绑定队列都不在使用时，自动删除交换器。【**一次性**】
   1. 前提：必须有一个消费者连接过。
   2. 所有客户端都断开时，自动删除。
5. arguments：结构化参数。

## 声明已有队列

```java
Queue.DeclareOk queueDeclarePassive(String queue) throws IOException;
```

1. 队列不存在时抛出 404 异常。

## 删除队列

```java
Queue.DeleteOk queueDelete(String queue, boolean ifUnused, boolean ifEmpty) throws IOException;
```

### 不建议使用

```java
void queueDeleteNoWait(String queue, boolean ifUnused, boolean ifEmpty) throws IOException;
```

无返回值。

## 绑定队列

```java
Queue.BindOk queueBind(
  String queue, 
  String exchange, 
  String routingKey, 
  Map<String, Object> arguments
) throws IOException;
```

1. queue：队列名称。
2. exchange：交换器名称。
3. routingKey：绑定队列和交换器的路由键。
4. arguments：绑定时的额外参数。

## 解绑队列

```java
Queue.UnbindOk queueUnbind(
  String queue,
  String exchange, 
  String routingKey, 
  Map<String, Object> arguments
) throws IOException;
```

## 注意

1. 消费者在同一信道订阅其他队列后，不可再声明队列。【订阅排他】。

# 发送消息

```java
void basicPublish(
  String exchange, 
  String routingKey, 
  boolean mandatory, 
  boolean immediate, 
  BasicProperties props, 
  byte[] body
) throws IOException;
```

1. exchange：交换器名称。
2. routingKey：指定的路由键。为空
3. mandatory：

# 接收消息